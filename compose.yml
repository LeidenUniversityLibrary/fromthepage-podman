# version: "3.8"
services:
  fromthepage:
    # build:
    #   dockerfile: Containerfile
    #   context: .
    image: docker.io/bencomp/fromthepage:production
    platform: "linux/amd64"
    environment:
    # - DATABASE_ADAPTER=mysql
    # - DATABASE_URL="mysql2://fromthepage:fromthepage@mysql/diary_development"
    - RAILS_ENV=development
    depends_on:
    - "mysql"
    ports:
    - "3000:3000"
    volumes:
      - fromthepage_config:/home/fromthepage/config
      - fromthepage_public:/home/fromthepage/public
    restart: always

  mysql:
    image: mysql:5.7
    platform: "linux/amd64"
    environment:
    - MYSQL_RANDOM_ROOT_PASSWORD=yes
    - MYSQL_USER=fromthepage
    - MYSQL_PASSWORD=fromthepage
    - MYSQL_DATABASE=diary_development
    volumes:
    - fromthepage_mysql_data:/var/lib/mysql
    - ./data:/docker-entrypoint-initdb.d
    restart: always

volumes:
  fromthepage_mysql_data:
  fromthepage_config:
  fromthepage_public:
